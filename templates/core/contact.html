{% extends "base.html" %}
{% load static %}

{% block title %}Contact Us - {{ site_settings.site_name }}{% endblock %}

{% block extra_css %}
<style>
    /* Map Container */
    .contact-map {
        height: 400px;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        border: 1px solid #e9ecef;
        background-color: #f5f5f5;
        position: relative;
        margin-bottom: 2rem;
    }
    
    /* Map Fallback */
    .map-placeholder {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #e9ecef;
        color: #6c757d;
        text-align: center;
        padding: 2rem;
        z-index: 10;
    }
    
    /* Contact Cards */
    .contact-info-card {
        border-radius: 12px;
        border: none;
        box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        transition: all 0.3s ease;
        background: white;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }
    
    .contact-info-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 15px rgba(0,0,0,0.1);
    }
    
    /* Contact Icons */
    .contact-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: #4361ee;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        margin-right: 1rem;
        flex-shrink: 0;
    }
    
    /* Contact Form */
    .contact-form-card {
        border-radius: 12px;
        border: none;
        box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        padding: 2rem;
        background: white;
    }
    
    .form-control, .form-select {
        border: 2px solid #e9ecef;
        border-radius: 8px;
        padding: 0.75rem 1rem;
        transition: all 0.3s ease;
    }
    
    .form-control:focus, .form-select:focus {
        border-color: #4361ee;
        box-shadow: 0 0 0 0.2rem rgba(67, 97, 238, 0.25);
    }
    
    /* Social Links */
    .social-link {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        transition: all 0.3s ease;
        text-decoration: none;
    }
    
    .social-link:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    /* FAQ Accordion */
    .faq-accordion .accordion-button:not(.collapsed) {
        background-color: rgba(67, 97, 238, 0.1);
        color: #4361ee;
        box-shadow: none;
    }
    
    .faq-accordion .accordion-button:focus {
        box-shadow: none;
        border-color: #4361ee;
    }
    
    .faq-accordion .accordion-item {
        border: none;
        margin-bottom: 0.5rem;
    }
    
    .faq-accordion .accordion-button {
        border-radius: 8px !important;
        padding: 1rem 1.25rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- Hero Section -->
    <div class="text-center mb-5">
        <h1 class="display-4 fw-bold mb-3">Get in Touch</h1>
        <p class="lead text-muted mx-auto" style="max-width: 600px;">
            Have questions or want to discuss a project? We'd love to hear from you.
            Our team is ready to help you with any inquiries.
        </p>
    </div>

    <div class="row g-4">
        <!-- Contact Information -->
        <div class="col-lg-4">
            <div class="contact-info-card">
                <div class="d-flex align-items-center mb-4">
                    <div class="contact-icon">
                        <i class="fas fa-map-marker-alt"></i>
                    </div>
                    <div>
                        <h5 class="mb-1">Our Location</h5>
                        <p class="mb-0 text-muted">{{ company_info.address|linebreaks }}</p>
                    </div>
                </div>
                
                <div class="d-flex align-items-center mb-4">
                    <div class="contact-icon">
                        <i class="fas fa-envelope"></i>
                    </div>
                    <div>
                        <h5 class="mb-1">Email Us</h5>
                        <p class="mb-0">
                            <a href="mailto:{{ company_info.email }}" class="text-decoration-none">
                                {{ company_info.email }}
                            </a>
                        </p>
                    </div>
                </div>
                
                <div class="d-flex align-items-center mb-4">
                    <div class="contact-icon">
                        <i class="fas fa-phone"></i>
                    </div>
                    <div>
                        <h5 class="mb-1">Call Us</h5>
                        <p class="mb-0">
                            <a href="tel:{{ company_info.phone }}" class="text-decoration-none">
                                {{ company_info.phone }}
                            </a>
                        </p>
                    </div>
                </div>
                
                <div class="d-flex align-items-center">
                    <div class="contact-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div>
                        <h5 class="mb-1">Working Hours</h5>
                        <p class="mb-0 text-muted">{{ company_info.working_hours }}</p>
                    </div>
                </div>
            </div>
            
            <!-- Social Media -->
            <div class="contact-info-card">
                <h5 class="mb-4">Follow Us</h5>
                <div class="d-flex gap-3">
                    <a href="#" class="social-link" style="background: #3b5998;">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="#" class="social-link" style="background: #1da1f2;">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="#" class="social-link" style="background: #0077b5;">
                        <i class="fab fa-linkedin-in"></i>
                    </a>
                    <a href="#" class="social-link" style="background: #333;">
                        <i class="fab fa-github"></i>
                    </a>
                    <a href="#" class="social-link" style="background: #e1306c;">
                        <i class="fab fa-instagram"></i>
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Contact Form and Map -->
        <div class="col-lg-8">
            <!-- Interactive Map with Fallback -->
            <div class="contact-map" id="map">
                <div class="map-placeholder" id="mapFallback">
                    <div class="text-center p-4">
                        <i class="fas fa-map-marked-alt fa-3x mb-3 text-primary"></i>
                        <h5>Our Location</h5>
                        <p class="mb-2">{{ company_info.address|linebreaks }}</p>
                        <a href="https://maps.google.com/?q={{ company_info.address|urlencode }}" 
                           target="_blank" class="btn btn-sm btn-outline-primary mt-2">
                            Open in Google Maps
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Contact Form -->
            <div class="contact-form-card">
                <h3 class="mb-4">Send Us a Message</h3>
                
                {% if messages %}
                    {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show mb-4" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                    {% endfor %}
                {% endif %}
                
                <form method="post" id="contactForm">
                    {% csrf_token %}
                    
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="name" class="form-label">Your Name *</label>
                            <input type="text" class="form-control" id="name" name="name" required>
                        </div>
                        
                        <div class="col-md-6">
                            <label for="email" class="form-label">Email Address *</label>
                            <input type="email" class="form-control" id="email" name="email" required>
                        </div>
                        
                        <div class="col-md-6">
                            <label for="phone" class="form-label">Phone Number</label>
                            <input type="tel" class="form-control" id="phone" name="phone">
                        </div>
                        
                        <div class="col-md-6">
                            <label for="subject" class="form-label">Subject *</label>
                            <select class="form-select" id="subject" name="subject" required>
                                <option value="" selected disabled>Select a subject</option>
                                <option value="general">General Inquiry</option>
                                <option value="support">Technical Support</option>
                                <option value="sales">Sales Question</option>
                                <option value="feedback">Feedback/Suggestions</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div class="col-12">
                            <label for="message" class="form-label">Your Message *</label>
                            <textarea class="form-control" id="message" name="message" rows="5" required></textarea>
                        </div>
                        
                        <div class="col-12">
                            <button type="submit" class="btn btn-primary px-4 py-2">
                                <i class="fas fa-paper-plane me-2"></i> Send Message
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- FAQs Section -->
    {% if faqs %}
    <div class="row mt-5">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body p-4">
                    <h3 class="text-center mb-4">Frequently Asked Questions</h3>
                    
                    <div class="accordion faq-accordion" id="faqAccordion">
                        {% for faq in faqs %}
                        <div class="accordion-item border-0 mb-3">
                            <h5 class="accordion-header" id="heading{{ faq.id }}">
                                <button class="accordion-button collapsed rounded-3" type="button" 
                                        data-bs-toggle="collapse" data-bs-target="#collapse{{ faq.id }}" 
                                        aria-expanded="false" aria-controls="collapse{{ faq.id }}">
                                    {{ faq.question }}
                                </button>
                            </h5>
                            <div id="collapse{{ faq.id }}" class="accordion-collapse collapse" 
                                 aria-labelledby="heading{{ faq.id }}" data-bs-parent="#faqAccordion">
                                <div class="accordion-body pt-0">
                                    {{ faq.answer|linebreaks }}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Initialize and display the map with error handling
    function initMap() {
        try {
            // Replace with your actual coordinates
            const location = { lat: -1.2921, lng: 36.8219 }; // Example: Nairobi coordinates
            
            const map = new google.maps.Map(document.getElementById("map"), {
                zoom: 15,
                center: location,
                styles: [
                    {
                        "featureType": "administrative",
                        "elementType": "labels.text.fill",
                        "stylers": [{"color": "#444444"}]
                    },
                    {
                        "featureType": "landscape",
                        "elementType": "all",
                        "stylers": [{"color": "#f2f2f2"}]
                    },
                    {
                        "featureType": "poi",
                        "elementType": "all",
                        "stylers": [{"visibility": "off"}]
                    },
                    {
                        "featureType": "road",
                        "elementType": "all",
                        "stylers": [{"saturation": -100}, {"lightness": 45}]
                    },
                    {
                        "featureType": "road.highway",
                        "elementType": "all",
                        "stylers": [{"visibility": "simplified"}]
                    },
                    {
                        "featureType": "road.arterial",
                        "elementType": "labels.icon",
                        "stylers": [{"visibility": "off"}]
                    },
                    {
                        "featureType": "transit",
                        "elementType": "all",
                        "stylers": [{"visibility": "off"}]
                    },
                    {
                        "featureType": "water",
                        "elementType": "all",
                        "stylers": [{"color": "#4361ee"}, {"visibility": "on"}]
                    }
                ]
            });
            
            // Hide the fallback
            document.getElementById('mapFallback').style.display = 'none';
            
            // Custom marker icon (replace with your own image if desired)
            const marker = new google.maps.Marker({
                position: location,
                map: map,
                title: "{{ site_settings.site_name }}",
                icon: {
                    url: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 384 512'%3E%3Cpath fill='%234361ee' d='M172.268 501.67C26.97 291.031 0 269.413 0 192 0 85.961 85.961 0 192 0s192 85.961 192 192c0 77.413-26.97 99.031-172.268 309.67-9.535 13.774-29.93 13.773-39.464 0z'/%3E%3C/svg%3E",
                    scaledSize: new google.maps.Size(40, 40)
                }
            });
            
            // Info window
            const infoWindow = new google.maps.InfoWindow({
                content: `
                    <div style="padding: 10px;">
                        <h5 style="margin-bottom: 5px; color: #4361ee;">{{ site_settings.site_name }}</h5>
                        <p style="margin: 0;">{{ company_info.address|linebreaksbr }}</p>
                    </div>
                `
            });
            
            marker.addListener("click", () => {
                infoWindow.open(map, marker);
            });
            
        } catch (error) {
            console.error("Google Maps error:", error);
            // Fallback remains visible
        }
    }

    // Load Google Maps API with callback
    function loadGoogleMaps() {
        // Replace with your actual API key
        const apiKey = "YOUR_GOOGLE_MAPS_API_KEY";
        
        if (!apiKey || apiKey === "YOUR_GOOGLE_MAPS_API_KEY") {
            console.warn("Google Maps API key not configured");
            return;
        }
        
        const script = document.createElement('script');
        script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&callback=initMap`;
        script.async = true;
        script.defer = true;
        script.onerror = function() {
            console.error("Failed to load Google Maps script");
            // Fallback will remain visible
        };
        document.head.appendChild(script);
    }

    // Load the map when the page loads
    $(document).ready(function() {
        loadGoogleMaps();
        
        // Form submission handling
        $('#contactForm').submit(function(e) {
            const submitBtn = $(this).find('button[type="submit"]');
            const originalText = submitBtn.html();
            
            submitBtn.html('<i class="fas fa-spinner fa-spin me-2"></i> Sending...');
            submitBtn.prop('disabled', true);
            
            // You could add AJAX form submission here if preferred
            // Otherwise, the form will submit normally
            
            // For demonstration, re-enable after 3 seconds if AJAX isn't implemented
            setTimeout(function() {
                submitBtn.html(originalText);
                submitBtn.prop('disabled', false);
            }, 3000);
        });
    });
</script>
{% endblock %}